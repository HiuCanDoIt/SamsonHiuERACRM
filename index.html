import React, { useState, useEffect, useRef } from 'react';
import { Search, Plus, X, Edit2, Trash2, Mail, Phone, User, MapPin, Home, Calendar, Users, Camera, Upload, MessageCircle } from 'lucide-react';

export default function ERACRMApp() {
  // ADD YOUR ANTHROPIC API KEY HERE
  // Get it from: https://console.anthropic.com
  const ANTHROPIC_API_KEY = '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'; // Replace with your actual API key
  
  const [clients, setClients] = useState([]);
  const [filteredClients, setFilteredClients] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedClient, setSelectedClient] = useState(null);
  const [showModal, setShowModal] = useState(false);
  const [modalMode, setModalMode] = useState('add');
  const [isScanning, setIsScanning] = useState(false);
  const [showCamera, setShowCamera] = useState(false);
  const videoRef = useRef(null);
  const canvasRef = useRef(null);
  const streamRef = useRef(null);
  const fileInputRef = useRef(null);
  
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    phone: '',
    secondaryPhone: '',
    preferredContact: 'phone',
    nationality: '',
    occupation: '',
    religion: '',
    maritalStatus: '',
    numberOfKids: '',
    budget: '',
    currentPropertyType: '',
    currentPropertyLocation: '',
    desiredPropertyType: '',
    desiredPropertyLocation: '',
    bedrooms: '',
    moveInDate: '',
    familySize: '',
    notes: '',
    leadSource: '',
    leadType: 'buyer'
  });

  useEffect(() => {
    loadClients();
    addSampleData();
  }, []);

  useEffect(() => {
    const filtered = clients.filter(client =>
      client.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      client.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
      client.phone.includes(searchTerm)
    );
    setFilteredClients(filtered);
  }, [searchTerm, clients]);

  const loadClients = async () => {
    try {
      const result = await window.storage.list('eraclient:');
      if (result && result.keys) {
        const clientData = await Promise.all(
          result.keys.map(async (key) => {
            try {
              const data = await window.storage.get(key);
              return data ? JSON.parse(data.value) : null;
            } catch {
              return null;
            }
          })
        );
        setClients(clientData.filter(c => c !== null));
      }
    } catch (error) {
      console.log('No existing clients found');
    }
  };

  const addSampleData = async () => {
    try {
      const checkSample = await window.storage.get('eraclient:sample_demo');
      if (!checkSample) {
        const sampleClients = [
          {
            id: 'sample_demo',
            name: 'Tan Wei Ming',
            email: 'weiming.tan@email.com',
            phone: '+65 9123 4567',
            secondaryPhone: '',
            preferredContact: 'whatsapp',
            nationality: 'Singaporean',
            occupation: 'Software Engineer',
            budget: '800000',
            propertyType: 'HDB 4-Room',
            preferredLocation: 'Tampines',
            bedrooms: '4',
            moveInDate: '2025-03-01',
            familySize: '4 members',
            notes: 'Looking for upgraded HDB near MRT.',
            leadSource: 'PropertyGuru',
            leadType: 'buyer',
            createdAt: new Date().toISOString(),
            lastUpdated: new Date().toISOString()
          }
        ];

        for (const client of sampleClients) {
          await window.storage.set(`eraclient:${client.id}`, JSON.stringify(client));
        }
        
        await loadClients();
      }
    } catch (error) {
      console.log('Sample data already exists');
    }
  };

  const saveClient = async () => {
    if (!formData.name || !formData.phone) {
      alert('Name and phone number are required');
      return;
    }

    const client = {
      ...formData,
      id: modalMode === 'edit' ? formData.id : `eraclient_${Date.now()}`,
      createdAt: modalMode === 'edit' ? formData.createdAt : new Date().toISOString(),
      lastUpdated: new Date().toISOString()
    };

    try {
      await window.storage.set(`eraclient:${client.id}`, JSON.stringify(client));
      await loadClients();
      setShowModal(false);
      resetForm();
    } catch (error) {
      alert('Error saving client');
    }
  };

  const deleteClient = async (clientId) => {
    if (window.confirm('Are you sure you want to delete this client?')) {
      try {
        await window.storage.delete(`eraclient:${clientId}`);
        await loadClients();
        setSelectedClient(null);
      } catch (error) {
        alert('Error deleting client');
      }
    }
  };

  const openAddModal = () => {
    setModalMode('add');
    resetForm();
    setShowModal(true);
  };

  const openEditModal = (client) => {
    setModalMode('edit');
    setFormData(client);
    setShowModal(true);
  };

  const resetForm = () => {
    setFormData({
      name: '',
      email: '',
      phone: '',
      secondaryPhone: '',
      preferredContact: 'phone',
      nationality: '',
      occupation: '',
      religion: '',
      maritalStatus: '',
      numberOfKids: '',
      budget: '',
      currentPropertyType: '',
      currentPropertyLocation: '',
      desiredPropertyType: '',
      desiredPropertyLocation: '',
      bedrooms: '',
      moveInDate: '',
      familySize: '',
      notes: '',
      leadSource: '',
      leadType: 'buyer'
    });
  };

  const startCamera = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: 'environment' } 
      });
      streamRef.current = stream;
      if (videoRef.current) {
        videoRef.current.srcObject = stream;
      }
      setShowCamera(true);
    } catch (error) {
      alert('Unable to access camera. Please use file upload instead.');
    }
  };

  const stopCamera = () => {
    if (streamRef.current) {
      streamRef.current.getTracks().forEach(track => track.stop());
    }
    setShowCamera(false);
  };

  const capturePhoto = () => {
    const video = videoRef.current;
    const canvas = canvasRef.current;
    
    if (video && canvas) {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0);
      
      canvas.toBlob((blob) => {
        processIDImage(blob);
      }, 'image/jpeg', 0.95);
    }
  };

  const handleFileUpload = (event) => {
    const file = event.target.files[0];
    if (file) {
      processIDImage(file);
    }
  };

  const processIDImage = async (imageBlob) => {
    // Check if API key is set
    if (ANTHROPIC_API_KEY === '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') {
      alert('Please add your Anthropic API key to enable ID scanning. Get one at https://console.anthropic.com');
      setIsScanning(false);
      stopCamera();
      return;
    }

    setIsScanning(true);
    stopCamera();

    try {
      const reader = new FileReader();
      reader.readAsDataURL(imageBlob);
      
      reader.onloadend = async () => {
        const base64Image = reader.result.split(',')[1];
        
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': ANTHROPIC_API_KEY,
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: 1000,
            messages: [
              {
                role: 'user',
                content: [
                  {
                    type: 'image',
                    source: {
                      type: 'base64',
                      media_type: 'image/jpeg',
                      data: base64Image
                    }
                  },
                  {
                    type: 'text',
                    text: 'Extract information from this ID card. Return ONLY a JSON object with these fields: {"name": "", "nationality": "", "idNumber": ""}. Extract exactly what you see.'
                  }
                ]
              }
            ]
          })
        });

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error.message || 'API error');
        }
        
        const textContent = data.content.find(item => item.type === 'text')?.text || '';
        
        const jsonMatch = textContent.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          const extractedData = JSON.parse(jsonMatch[0]);
          
          setFormData(prev => ({
            ...prev,
            name: extractedData.name || prev.name,
            nationality: extractedData.nationality || prev.nationality,
            notes: prev.notes ? `${prev.notes}\nID: ${extractedData.idNumber || 'N/A'}` : `ID: ${extractedData.idNumber || 'N/A'}`
          }));
          
          alert('ID information extracted successfully!');
        } else {
          throw new Error('Could not parse ID information');
        }
      };
    } catch (error) {
      console.error('Error scanning ID:', error);
      alert(`Failed to scan ID: ${error.message}. Please enter details manually.`);
    } finally {
      setIsScanning(false);
    }
  };

  const openWhatsApp = (phone, name) => {
    const cleanPhone = phone.replace(/[^\d]/g, '');
    let formattedPhone = cleanPhone.startsWith('65') ? cleanPhone : '65' + cleanPhone;
    const message = `Hi ${name}, this is your ERA property agent. I wanted to follow up with you regarding your property search.`;
    const encodedMessage = encodeURIComponent(message);
    window.open(`https://wa.me/${formattedPhone}?text=${encodedMessage}`, '_blank');
  };

  const openWhatsAppEmpty = (phone) => {
    const cleanPhone = phone.replace(/[^\d]/g, '');
    let formattedPhone = cleanPhone.startsWith('65') ? cleanPhone : '65' + cleanPhone;
    window.open(`https://wa.me/${formattedPhone}`, '_blank');
  };

  const getLeadTypeColor = (type) => {
    const colors = {
      buyer: 'bg-blue-100 text-blue-800',
      seller: 'bg-green-100 text-green-800',
      tenant: 'bg-purple-100 text-purple-800',
      landlord: 'bg-orange-100 text-orange-800'
    };
    return colors[type] || 'bg-gray-100 text-gray-800';
  };

  const stats = {
    total: clients.length,
    buyers: clients.filter(c => c.leadType === 'buyer').length,
    sellers: clients.filter(c => c.leadType === 'seller').length,
    tenants: clients.filter(c => c.leadType === 'tenant').length
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-red-50 to-gray-100">
      <div className="max-w-7xl mx-auto p-6">
        <div className="mb-8">
          <div className="flex items-center gap-3 mb-2">
            <div className="bg-red-600 text-white px-4 py-2 rounded font-bold text-xl">ERA</div>
            <h1 className="text-3xl font-bold text-gray-800">Client & Lead Management</h1>
          </div>
          <p className="text-gray-600">Track your clients and leads for better relationship management</p>
        </div>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div className="bg-white rounded-lg shadow-md p-4">
            <p className="text-gray-500 text-sm">Total Clients</p>
            <p className="text-2xl font-bold text-gray-800">{stats.total}</p>
          </div>
          <div className="bg-white rounded-lg shadow-md p-4">
            <p className="text-gray-500 text-sm">Buyers</p>
            <p className="text-2xl font-bold text-blue-600">{stats.buyers}</p>
          </div>
          <div className="bg-white rounded-lg shadow-md p-4">
            <p className="text-gray-500 text-sm">Sellers</p>
            <p className="text-2xl font-bold text-green-600">{stats.sellers}</p>
          </div>
          <div className="bg-white rounded-lg shadow-md p-4">
            <p className="text-gray-500 text-sm">Tenants</p>
            <p className="text-2xl font-bold text-purple-600">{stats.tenants}</p>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-md p-4 mb-6">
          <div className="flex gap-4">
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-3 text-gray-400" size={20} />
              <input
                type="text"
                placeholder="Search by name, phone, or email..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
              />
            </div>
            <button
              onClick={openAddModal}
              className="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 flex items-center gap-2 transition-colors"
            >
              <Plus size={20} />
              Add Client
            </button>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div className="lg:col-span-1 bg-white rounded-lg shadow-md overflow-hidden">
            <div className="p-4 bg-gray-50 border-b">
              <h2 className="font-semibold text-gray-800">Clients & Leads ({filteredClients.length})</h2>
            </div>
            <div className="overflow-y-auto max-h-[600px]">
              {filteredClients.length === 0 ? (
                <div className="p-8 text-center text-gray-500">
                  <Users size={48} className="mx-auto mb-4 text-gray-300" />
                  <p>No clients found</p>
                  <p className="text-sm">Add your first client to get started</p>
                </div>
              ) : (
                filteredClients.map((client) => (
                  <div
                    key={client.id}
                    onClick={() => setSelectedClient(client)}
                    className={`p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ${
                      selectedClient?.id === client.id ? 'bg-red-50 border-l-4 border-l-red-600' : ''
                    }`}
                  >
                    <h3 className="font-semibold text-gray-800">{client.name}</h3>
                    <p className="text-sm text-gray-600">{client.phone}</p>
                    <div className="flex items-center gap-2 mt-2">
                      <span className={`text-xs px-2 py-1 rounded-full ${getLeadTypeColor(client.leadType)}`}>
                        {client.leadType}
                      </span>
                      {client.propertyType && (
                        <span className="text-xs text-gray-500">{client.propertyType}</span>
                      )}
                    </div>
                  </div>
                ))
              )}
            </div>
          </div>

          <div className="lg:col-span-2 bg-white rounded-lg shadow-md">
            {selectedClient ? (
              <div className="p-6">
                <div className="flex justify-between items-start mb-6">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-800">{selectedClient.name}</h2>
                    <span className={`inline-block mt-2 text-sm px-3 py-1 rounded-full ${getLeadTypeColor(selectedClient.leadType)}`}>
                      {selectedClient.leadType.charAt(0).toUpperCase() + selectedClient.leadType.slice(1)}
                    </span>
                  </div>
                  <div className="flex gap-2">
                    <button
                      onClick={() => openWhatsApp(selectedClient.phone, selectedClient.name)}
                      className="p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors"
                      title="Message on WhatsApp"
                    >
                      <MessageCircle size={20} />
                    </button>
                    <button
                      onClick={() => openEditModal(selectedClient)}
                      className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                    >
                      <Edit2 size={20} />
                    </button>
                    <button
                      onClick={() => deleteClient(selectedClient.id)}
                      className="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                    >
                      <Trash2 size={20} />
                    </button>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <h3 className="font-semibold text-gray-700 mb-3">Contact Information</h3>
                    <div className="space-y-3">
                      <div className="flex items-center gap-3 text-gray-700">
                        <Phone size={18} className="text-gray-400" />
                        <a href={`tel:${selectedClient.phone}`} className="hover:text-red-600">
                          {selectedClient.phone}
                        </a>
                        <button
                          onClick={() => openWhatsAppEmpty(selectedClient.phone)}
                          className="ml-auto p-1 text-green-600 hover:bg-green-50 rounded"
                        >
                          <MessageCircle size={16} />
                        </button>
                      </div>
                      {selectedClient.email && (
                        <div className="flex items-center gap-3 text-gray-700">
                          <Mail size={18} className="text-gray-400" />
                          <a href={`mailto:${selectedClient.email}`} className="hover:text-red-600">
                            {selectedClient.email}
                          </a>
                        </div>
                      )}
                    </div>
                  </div>

                  <div>
                    <h3 className="font-semibold text-gray-700 mb-3">Personal Details</h3>
                    <div className="space-y-3">
                      {selectedClient.nationality && (
                        <div className="text-gray-700">
                          <div className="text-xs text-gray-500">Nationality</div>
                          <div>{selectedClient.nationality}</div>
                        </div>
                      )}
                      {selectedClient.occupation && (
                        <div className="text-gray-700">
                          <div className="text-xs text-gray-500">Occupation</div>
                          <div>{selectedClient.occupation}</div>
                        </div>
                      )}
                      {selectedClient.religion && (
                        <div className="text-gray-700">
                          <div className="text-xs text-gray-500">Religion</div>
                          <div>{selectedClient.religion}</div>
                        </div>
                      )}
                      {selectedClient.maritalStatus && (
                        <div className="text-gray-700">
                          <div className="text-xs text-gray-500">Marital Status</div>
                          <div>{selectedClient.maritalStatus}</div>
                        </div>
                      )}
                      {selectedClient.numberOfKids && (
                        <div className="text-gray-700">
                          <div className="text-xs text-gray-500">Number of Kids</div>
                          <div>{selectedClient.numberOfKids}</div>
                        </div>
                      )}
                    </div>
                  </div>
                </div>

                {selectedClient.propertyType && (
                  <div className="mt-6 pt-6 border-t">
                    <h3 className="font-semibold text-gray-700 mb-3">Property Requirements</h3>
                    <div className="grid grid-cols-2 gap-4 text-gray-700">
                      <div>Type: {selectedClient.propertyType}</div>
                      {selectedClient.preferredLocation && <div>Location: {selectedClient.preferredLocation}</div>}
                      {selectedClient.budget && <div>Budget: ${selectedClient.budget}</div>}
                      {selectedClient.bedrooms && <div>Bedrooms: {selectedClient.bedrooms}</div>}
                    </div>
                  </div>
                )}

                {selectedClient.notes && (
                  <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h3 className="font-semibold text-gray-800 mb-2">Notes</h3>
                    <p className="text-gray-700 whitespace-pre-wrap">{selectedClient.notes}</p>
                  </div>
                )}
              </div>
            ) : (
              <div className="p-12 text-center text-gray-500">
                <Users size={64} className="mx-auto mb-4 text-gray-300" />
                <p className="text-lg">Select a client to view details</p>
              </div>
            )}
          </div>
        </div>

        {showModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 overflow-y-auto pt-20">
            <div className="bg-white rounded-lg max-w-3xl w-full m-4 mb-8">
              <div className="p-6">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-2xl font-bold text-gray-800">
                    {modalMode === 'add' ? 'Add New Client' : 'Edit Client'}
                  </h2>
                  <button onClick={() => setShowModal(false)} className="text-gray-400 hover:text-gray-600">
                    <X size={24} />
                  </button>
                </div>

                <div className="space-y-6 max-h-[60vh] overflow-y-auto">
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 className="font-semibold text-blue-900 mb-3">Quick ID Scan</h3>
                    <p className="text-sm text-blue-700 mb-3">Scan Singapore NRIC or ID to auto-fill details</p>
                    
                    {showCamera ? (
                      <div className="space-y-3">
                        <video ref={videoRef} autoPlay playsInline className="w-full h-64 bg-black rounded" />
                        <div className="flex gap-2">
                          <button
                            type="button"
                            onClick={capturePhoto}
                            disabled={isScanning}
                            className="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400"
                          >
                            {isScanning ? 'Scanning...' : 'Capture'}
                          </button>
                          <button type="button" onClick={stopCamera} className="px-4 py-2 border rounded-lg">
                            Cancel
                          </button>
                        </div>
                      </div>
                    ) : (
                      <div className="flex gap-2">
                        <button
                          type="button"
                          onClick={startCamera}
                          disabled={isScanning}
                          className="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                        >
                          <Camera size={20} className="inline mr-2" />
                          Open Camera
                        </button>
                        <button
                          type="button"
                          onClick={() => fileInputRef.current?.click()}
                          disabled={isScanning}
                          className="flex-1 bg-white text-blue-600 border border-blue-600 px-4 py-2 rounded-lg"
                        >
                          <Upload size={20} className="inline mr-2" />
                          Upload
                        </button>
                      </div>
                    )}
                    
                    <input ref={fileInputRef} type="file" accept="image/*" onChange={handleFileUpload} className="hidden" />
                    <canvas ref={canvasRef} className="hidden" />
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-1">Full Name *</label>
                    <input
                      type="text"
                      value={formData.name}
                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                      className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                    />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-1">Phone *</label>
                      <input
                        type="tel"
                        value={formData.phone}
                        onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                        placeholder="+65 XXXX XXXX"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Email</label>
                      <input
                        type="email"
                        value={formData.email}
                        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                      />
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-1">Nationality</label>
                      <input
                        type="text"
                        value={formData.nationality}
                        onChange={(e) => setFormData({ ...formData, nationality: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                        placeholder="e.g., Singaporean"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Occupation</label>
                      <input
                        type="text"
                        value={formData.occupation}
                        onChange={(e) => setFormData({ ...formData, occupation: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                        placeholder="e.g., Engineer"
                      />
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-1">Religion</label>
                      <select
                        value={formData.religion}
                        onChange={(e) => setFormData({ ...formData, religion: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                      >
                        <option value="">Select religion</option>
                        <option value="Buddhism">Buddhism</option>
                        <option value="Christianity">Christianity</option>
                        <option value="Islam">Islam</option>
                        <option value="Hinduism">Hinduism</option>
                        <option value="Taoism">Taoism</option>
                        <option value="No Religion">No Religion</option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Marital Status</label>
                      <select
                        value={formData.maritalStatus}
                        onChange={(e) => setFormData({ ...formData, maritalStatus: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                      >
                        <option value="">Select status</option>
                        <option value="Single">Single</option>
                        <option value="Married">Married</option>
                        <option value="Divorced">Divorced</option>
                        <option value="Widowed">Widowed</option>
                      </select>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-1">Number of Kids</label>
                      <input
                        type="number"
                        value={formData.numberOfKids}
                        onChange={(e) => setFormData({ ...formData, numberOfKids: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                        placeholder="0"
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Lead Type</label>
                      <select
                        value={formData.leadType}
                        onChange={(e) => setFormData({ ...formData, leadType: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                      >
                        <option value="buyer">Buyer</option>
                        <option value="seller">Seller</option>
                        <option value="tenant">Tenant</option>
                        <option value="landlord">Landlord</option>
                      </select>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-1">Property Type</label>
                    <select
                      value={formData.propertyType}
                      onChange={(e) => setFormData({ ...formData, propertyType: e.target.value })}
                      className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                    >
                      <option value="">Select type</option>
                      <option value="HDB 2-Room">HDB 2-Room</option>
                      <option value="HDB 3-Room">HDB 3-Room</option>
                      <option value="HDB 4-Room">HDB 4-Room</option>
                      <option value="HDB 5-Room">HDB 5-Room</option>
                      <option value="Condominium">Condominium</option>
                      <option value="Landed">Landed Property</option>
                    </select>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-1">Budget (SGD)</label>
                      <input
                        type="text"
                        value={formData.budget}
                        onChange={(e) => setFormData({ ...formData, budget: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Preferred Location</label>
                      <input
                        type="text"
                        value={formData.preferredLocation}
                        onChange={(e) => setFormData({ ...formData, preferredLocation: e.target.value })}
                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium mb-1">Notes</label>
                    <textarea
                      value={formData.notes}
                      onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                      rows={3}
                      className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"
                    />
                  </div>
                </div>

                <div className="flex justify-end gap-3 mt-6">
                  <button
                    onClick={() => setShowModal(false)}
                    className="px-6 py-2 border rounded-lg hover:bg-gray-50"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={saveClient}
                    className="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
                  >
                    {modalMode === 'add' ? 'Add Client' : 'Save Changes'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
